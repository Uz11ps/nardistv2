#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ .env —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: bash upload-env.sh

SERVER_IP="89.104.65.118"
SERVER_USER="root"
SERVER_PATH="/opt/Nardist/.env"
LOCAL_ENV_FILE="backend/.env"

echo "üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ .env —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞
if [ ! -f "$LOCAL_ENV_FILE" ]; then
    echo "‚ùå –§–∞–π–ª $LOCAL_ENV_FILE –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

echo "‚úÖ –§–∞–π–ª –Ω–∞–π–¥–µ–Ω: $LOCAL_ENV_FILE"
echo "üöÄ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞..."
echo "üí° –í–∞–º –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—à–µ–Ω –ø–∞—Ä–æ–ª—å: 9kwQ9fYCh0wArbSh"
echo ""

# –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª
scp "$LOCAL_ENV_FILE" "${SERVER_USER}@${SERVER_IP}:${SERVER_PATH}"

if [ $? -eq 0 ]; then
    echo "‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!"
    
    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
    echo "üîí –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞..."
    ssh "${SERVER_USER}@${SERVER_IP}" "chmod 600 ${SERVER_PATH}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
    echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."
    ssh "${SERVER_USER}@${SERVER_IP}" "ls -la ${SERVER_PATH}"
    
    echo ""
    echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –§–∞–π–ª .env —Å–æ–∑–¥–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ."
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–∞"
    exit 1
fi

